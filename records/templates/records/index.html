{% extends 'ipams/base.html' %}
{% block footer %}
	<script>
		$(document).ready(function() {
		    $('#example').DataTable();
		} );

		$("#btn-import").on("click", function(){
			if($("#file-import").get(0).files.length>0){
				Swal.fire({
				  title: 'Import Spreadsheet',
				  html: 'importing... '+$("#file-import").val(),
				  allowOutsideClick: false,
				  onBeforeOpen: () => {
				   	Swal.showLoading()
				   	$("#form-import").submit();
				  },
				});
			}
			else{
				Swal.fire({
				  type: 'warning',
				  title: 'No File Chosen',
				  showConfirmButton: true,
				})
			}
		});

		{% if import_message == 'success' %}
			Swal.fire({
			  type: 'success',
			  title: 'Import Success!',
			  showConfirmButton: true,
			})
			{% elif import_message == 'failed' %}
			Swal.fire({
			  type: 'warning',
			  title: 'Import Failed!',
			  html: 'Some rows have unexpected values or you might have imported the wrong format',
			  showConfirmButton: true,
			})
		{% endif %}
	</script>
{% endblock %}

{% block content %}

	<div class="container">
		<div class="row" style="margin-top:30px">
			<div class="col-12">
				<h1>RECORDS</h1>
			</div>
		</div>
		<div class="row" style="margin-bottom:30px">
			<div class="col-2">
				<a href="{% url 'records-create' %}" class="btn btn-primary">ADD</a>
			</div>
			<div class="col-10">
				<form id="form-import" action="{% url 'records-upload' %}" method="POST" enctype="multipart/form-data">
	                {% csrf_token %}
	                <div class="row">
	                	<div class="col-6">
	                		<input id="file-import" type="file" name="file" class="form-control">
	            		</div>
	            		<div class="col-6">
	                		<button id="btn-import" type="button" class="btn btn-success">Import File</button>
	                	</div>
	                </div>
	            </form>
	        </div>
		</div>
		<!-- if record count is greater than 0 -->
			<div class="row" style="margin-bottom:30px">
				<div class="col-12">
					<table id="example" class="table table-striped table-bordered table-condensed table-hover" style="width:100%">
				        <thead>
				            <tr>
				                <th>RESEARCH TITLE</th>
				                <th>YEAR</th>
				                <th>CLASS</th>
				                <th>PSCED</th>
				            </tr>
				        </thead>
				        <tbody>
							{% for record in records %}
				        		<tr>
				        			<td><a href="{% url 'records-view' record_id=record.pk %}">{{ record.title }}</a></td>
				        			<td>{{ record.year_accomplished }}</td>
				        			<td>{{ record.classification }}</td>
				        			<td>{{ record.psced_classification }}</td>
				        		</tr>
				        	{% endfor %}
				        </tbody>
				    </table>
				</div>
			</div>

	</div>
{% endblock %}
