{% extends 'ipams/base.html' %}
{% load crispy_forms_tags %}
{% block head %}
<style>
	.title-checkbox{
		margin-right:8px;
	}
</style>
{% endblock %}
{% block footer %}
	<script>
//-----------------------initializing datatable---------------------------------------------
		var recordsTbl='a';
		$(document).ready(function() {
		    recordsTbl = $('#tbl-records').DataTable({
		    	"ajax":	{
		    		"headers": { "X-CSRFToken": '{{ csrf_token }}' },
		    		"url": "{% url 'records-index' %}",
		    		"data": {"test": "test"},
		    		"type": "post"
		    	},
		    	"order": [[ 1, "desc" ], [ 0, "asc" ]]
		    });
		} );
//------------------------importing spreadsheet----------------------------------------------
		$("#btn-import").on("click", function(){
			if($("#file-import").get(0).files.length>0){
				Swal.fire({
				  title: 'Import Spreadsheet',
				  html: 'importing... ',
				  allowOutsideClick: false,
				  onBeforeOpen: () => {
				   	Swal.showLoading()
				   	$("#form-import").submit();
				  },
				});
			}
			else{
				Swal.fire({
				  type: 'warning',
				  title: 'No File Chosen',
				  showConfirmButton: true,
				})
			}
		});
//--------------------------removing selected rows--------------------------------------
		$("#btn-remove").on("click", function(){
			var titles = [];
			$.each($("input[name='title-checkbox']:checked"), function(){
                titles.push($(this).val());
            });
            if(titles.length>0){
				Swal.fire({
				  title: 'Are you sure you want to delete the selected items?',
				  text: "You won't be able to revert this!",
				  type: 'warning',
				  showCancelButton: true,
				  confirmButtonColor: '#3085d6',
				  cancelButtonColor: '#d33',
				  confirmButtonText: 'Yes'
				}).then((result) => {
				  if (result.value) {
            		$.ajax({
            			headers: { "X-CSRFToken": '{{ csrf_token }}' },
            			url: "{% url 'records-index' %}",
            			type: "post",
						data: { "titles": titles, "remove": true },
						success: function(data){
							recordsTbl.ajax.reload();
							Swal.fire(
				    		  'Deleted!',
				    		  'The selected items have been deleted',
				    		  'success'
				    		)
						},
						error: function(data){
							alert("error");
						}
            		});
				  }
				})
			}



		});
//-------------------------------error messages---------------------------------------
		{% if import_message == 'success' %}
			Swal.fire({
			  type: 'success',
			  title: 'Import Success!',
			  showConfirmButton: true,
			})
			{% elif import_message == 'failed' %}
			Swal.fire({
			  type: 'warning',
			  title: 'Import Failed!',
			  html: 'Some rows have unexpected values or you might have imported the wrong format',
			  showConfirmButton: true,
			})
		{% endif %}


	</script>
{% endblock %}

{% block content %}

	<div class="container">

		{% include 'records/home_navbar.html' %}

		<div class="tab-content" id="nav-tabContent">
			<div class="tabheaher">&nbsp;</div>
			<div class="tab-pane fade show active" id="nav-home-records" role="tabpanel">
				<section id="home-records">
					<div class="row" style="margin-top:30px">
						<div class="col-12">
							<h1>RECORDS</h1>
						</div>
					</div>
					<div class="row" style="margin-bottom:30px">
						<div class="col-12">
							<a href="{% url 'records-add' %}" class="btn btn-primary">ADD</a>
							<button type="button" id="btn-remove" class="btn btn-danger">REMOVE</button>
							<button type="button" class="btn btn-success" data-toggle="modal" data-target="#filter-modal">FILTER</button>
						</div>
					</div>
					<div class="row" style="margin-bottom:30px">
						<div class="col-12">
							<table id="tbl-records" class="table table-striped table-bordered table-condensed table-hover" style="width:100%">
						        <thead>
						            <tr>
						                <th>RESEARCH TITLE</th>
						                <th>YEAR</th>
						                <th>CLASS</th>
						                <th>PSCED</th>
						            </tr>
						        </thead>
						        <tbody>
						        </tbody>
						    </table>
						</div>
					</div>
				</section>
			</div>
			<div class="tab-pane fade" id="nav-home-graphs" role="tabpanel">
				<section id="home-graphs">
					<div class="row">
						<div class="col-12">
							<h1>GRAPHS</h1>
						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<p>coming soon...</p>
						</div>
					</div>
				</section>
			</div>
			<div class="tab-pane fade" id="nav-home-upload" role="tabpanel">
				<section id="home-upload">
					<div class="row">
						<div class="col-lg-8">
							<h1>How to migrate data from spreadsheet?</h1>
							<ol>
								<li>Follow the data entry format which can be viewed <a href="#">HERE</a>.</li>
								<li>When adding a new entry to a section, simply duplicate the record row and replace the existing
section with the new entry.</li>
								<li>The migration stops when they read a merged cell that contains END OF RECORDS.</li>
								<li>After the format is thouroughly followed, Press GENERATE to add the records.</li>
							</ol>
						</div>
						<div class="col-lg-4">
							<form id="form-import" action="{% url 'records-upload' %}" method="POST" enctype="multipart/form-data">
								{% csrf_token %}
								<div class="row">
									<div class="col-12">
										<input id="file-import" type="file" name="file" class="form-control">
									</div>
								</div>
								<div class="row">
									<div class="col-12" style="margin-top:15px">
										<button id="btn-import" type="button" class="btn btn-success">GENERATE</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</section>
			</div>
		</div>
	</div>

	<!-- Modal -->
	<div class="modal fade" id="filter-modal" tabindex="-1" role="dialog" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Filter</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <div class="container">
				<div class="row">
					<div class="col-lg-5">
						<label>Year</label>
					</div>
					<div class="col-lg-7">
						<input class="form-control">
					</div>
				</div>
				<div class="row">
					<div class="col-lg-5">
						<label>Class</label>
					</div>
					<div class="col-lg-7">
						{{ record_form.classification|as_crispy_field }}
					</div>
				</div>
			 	<div class="row">
					<div class="col-lg-5">
						<label>PSCED</label>
					</div>
					<div class="col-lg-7">
						{{ record_form.psced_classification|as_crispy_field }}
					</div>
				</div>
				<div class="row">
					<div class="col-lg-5">
						<label>Author</label>
					</div>
					<div class="col-lg-7">
						<input class="form-control">
					</div>
				</div>
		  		<div class="row">
					<div class="col-lg-5">
						<label>Conference Title</label>
					</div>
					<div class="col-lg-7">
						<input class="form-control">
					</div>
				</div>
				<div class="row">
					<div class="col-lg-5">
						<label>Publication Name</label>
					</div>
					<div class="col-lg-7">
						<input class="form-control">
					</div>
				</div>
				<div class="row">
					<div class="col-lg-5">
						<label>Total Budget</label>
					</div>
					<div class="col-lg-3">
						<input class="form-control">
					</div>
					<div class="col-lg-3">
						<input class="form-control">
					</div>
				</div>
				<div class="row">
					<div class="col-lg-5">
						<label>Collaborator</label>
					</div>
					<div class="col-lg-7">
						<input class="form-control">
					</div>
				</div>
			</div>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	        <button type="button" class="btn btn-primary">Save changes</button>
	      </div>
	    </div>
	  </div>
	</div>
{% endblock %}
